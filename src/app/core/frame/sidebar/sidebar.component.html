<div class="sidebar-content h-full flex flex-col bg-surface-container">
  <!-- Sidebar Header -->
  <div class="p-4 border-b border-outline-variant">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-lg bg-primary flex items-center justify-center">
        <mat-icon class="text-on-primary">receipt_long</mat-icon>
      </div>
      <div class="flex-1 min-w-0">
        <h2 class="font-semibold text-on-surface">Invoice App</h2>
        <p class="text-sm text-on-surface-variant">v1.0.0</p>
      </div>
    </div>
  </div>

  <!-- Navigation Menu -->
  <nav class="flex-1 p-2 overflow-y-auto">
    <mat-nav-list>
      @for (item of menuItems(); track item.route) {
      <mat-list-item [routerLink]="item.route" routerLinkActive="active-menu-item" (click)="onMenuItemClick(item)"
        class="menu-item mb-1 rounded-lg cursor-pointer relative">

        <mat-icon matListItemIcon class="menu-icon">{{ item.icon }}</mat-icon>
        <span matListItemTitle class="menu-label">{{ item.label }}</span>

        <!-- Badge dinamico con gestione click e tooltip -->
        @if (item.badge && item.badge > 0) {
        <span class="badge" [class]="getBadgeClass(item.route)" [matTooltip]="getBadgeTooltip(item.route)"
          matTooltipPosition="above" (click)="onBadgeClick($event, item.route)">
          {{ item.badge > 99 ? '99+' : item.badge }}
        </span>
        }

        <!-- Indicatore per fatture scadute (rosso lampeggiante) -->
        @if (item.route === '/invoices' && overdueInvoicesCount() > 0) {
        <div class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
        }

        <!-- Indicatore per prodotti a basso stock (arancione lampeggiante) -->
        @if (item.route === '/products' && lowStockProductsCount() > 0) {
        <div class="absolute top-1 right-1 w-2 h-2 bg-orange-500 rounded-full animate-pulse"></div>
        }
      </mat-list-item>
      }
    </mat-nav-list>

    <mat-divider class="my-4"></mat-divider>

    <!-- Secondary Menu -->
    <div class="px-2">
      <mat-nav-list>
        @for (item of settingsItems(); track item.route) {
        <mat-list-item [routerLink]="item.route" routerLinkActive="active-menu-item" (click)="onMenuItemClick(item)"
          class="menu-item mb-1 rounded-lg cursor-pointer">

          <mat-icon matListItemIcon class="menu-icon">{{ item.icon }}</mat-icon>
          <span matListItemTitle class="menu-label">{{ item.label }}</span>
        </mat-list-item>
        }
      </mat-nav-list>
    </div>
  </nav>

  <!-- Sidebar Footer con Info Rapide -->
  <div class="p-4 border-t border-outline-variant">
    <!-- Mini statistiche -->
    <div class="text-xs text-on-surface-variant space-y-1 mb-3">
      <!-- Statistiche Fatture -->
      @if (pendingInvoicesCount() > 0) {
      <div class="flex items-center justify-between">
        <span>In attesa:</span>
        <span class="font-medium text-orange-600">{{ pendingInvoicesCount() }}</span>
      </div>
      }
      @if (overdueInvoicesCount() > 0) {
      <div class="flex items-center justify-between">
        <span>Scadute:</span>
        <span class="font-medium text-red-600">{{ overdueInvoicesCount() }}</span>
      </div>
      }

      <!-- Avviso prodotti a basso stock -->
      @if (lowStockProductsCount() > 0) {
      <div class="low-stock-alert" (click)="router.navigate(['/products'])" matTooltip="Click per andare ai prodotti"
        matTooltipPosition="above">
        <div class="flex items-center justify-between">
          <span class="text-xs">⚠️ Basso stock:</span>
          <span class="font-medium text-xs">{{ lowStockProductsCount() }}</span>
        </div>
      </div>
      }
    </div>

    <!-- Copyright -->
    <div class="text-xs text-on-surface-variant text-center">
      © 2025 Invoice Manager
    </div>
  </div>
</div>